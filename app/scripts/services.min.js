// --- file[enrollmentdata.js] ---

'use strict';

angular.module('dashApp')
  .factory('Enrollmentdata', ['$resource', function ($resource) {
    return $resource('/data/enrollment/:enrollmentController'+'.json', 
      {
        enrollmentController: "@enrollmentController",
        startDate: "@startDate",
        endDate: "@endDate",
        communicationType: "@communicationType",
        product: "@product",
        
      },
      {
        'enrollment': { 
          method: 'GET', 
          params:{
            enrollmentController: "enrollment"
          },
          isArray: false
        },
        'signup': {
          method: "GET",
          isArray: false,
          params: {
            enrollmentController: "signup",
            startDate: "startDate",
            endDate: "endDate"
            // communicationType: "communicationType",
            // product: "product"
          }
        },
        'distributed': {
          method: "GET",
          params: {
            enrollmentController: "distributed",
            startDate: "startDate",
            endDate: "endDate"
            // communicationType: "communicationType",
            // product: "product"
          },
          isArray: false
        },
        'setup': {
          method: "GET",
          params: {
            enrollmentController: "setup",
            startDate: "startDate",
            endDate: "endDate"
            // communicationType: "communicationType",
            // product: "product"
          },
          isArray: false
        },
        'optout': {
          method: "GET",
          params: {
            enrollmentController: "optout",
            startDate: "startDate",
            endDate: "endDate"
            // communicationType: "communicationType",
            // product: "product"
          },
          isArray: false
        },
        'online': {
          method: "GET",
          params: {
            enrollmentController: "online",
            startDate: "startDate",
            endDate: "endDate"
            // communicationType: "communicationType",
            // product: "product"
          },
          isArray: false
        }
      });
}]);      



// --- file[module.js] ---

 'use strict';
/*global alert:false */
// /*global $:false */


/**
 * @ngdoc service
 * @name dashApp.module
 * @description
 * # module
 * Service in the dashApp.
 */
angular.module('dashApp')
  .service('module', function module($cacheFactory, Enrollmentdata) {
    // AngularJS will instantiate a singleton by calling "new" on this function
    var cache = $cacheFactory('modules');

    function getModule(name, startDate, endDate, success, failure){
        var cacheData = cache.get(name);

        if (cacheData === undefined || startDate !== null){
          var str = 'signup';
          if (name === 'Distributed'){
            str = 'distributed';
          }
          else if (name === 'Set-ups'){
            str = 'setup';
          }
          // else if (name === 'Opt-outs'){
          //   str = 'optout';
          // }
          else if (name === 'Callable Load'){
            str = 'online';
          }
          // var str = 'signup';
          // $http.get(url + str + "?startDate=" + startDate + "&endDate=" + endDate, { timeout: timeout })
            var enrollment = Enrollmentdata[str]({"startDate": startDate, "endDate": endDate}, 
              function(data){
              if (success){
                  
                  if (data[name] !== undefined){
                      cache.put(name, data[name]);
                      success(name, data[name]);
                      console.log(data[name]);
                  }
                  else{
                    failure(name);
                  }
              }
          },
          function(error){
            alert('getting data failed. Try refreshing the page.');
             console.log(enrollment);
          }
        )
         }
        else{
          success(name, cacheData);
        }
    }
    return {
        getModule: getModule
    };
  });

// --- file[program.js] ---

'use strict';
/*global $:false */
/*global alert:false */

/**
 * @ngdoc service
 * @name dashApp.program
 * @description
 * # program
 * Factory in the dashApp.
 */
var debug = "http://10.0.0.52:4444/api/",
    prod = "http://utility-webapi.cloudapp.net:5555/api/";
    // url = debug;
    // url = prod;
    // url = 'data/program.json' ;

angular.module('dashApp')
  .factory('program', function ($http) {
      return {
          getProgram: function(callback){
            // $http.get(url + 'program', { timeout: timeout })
            $http.get('data/dashboard.json', { timeout: timeout })
            .success(callback)
            .error(function(){
              $('#loading').hide();
              alert('There was an error getting program data. Try refreshing the page.');
            });
          }
      };
  });

// --- file[user.js] ---

'use strict';

/**
 * @ngdoc service
 * @name dashApp.user
 * @description
 * # user
 * Factory in the dashApp.
 */
angular.module('dashApp')
  .factory('user', function ($http, $rootScope) {
    return {
        getUser: function(callback){
          $rootScope.user = {
            'firstName': 'coolNYC',
            'lastName': 'Admin',
            'email': 'coolnycprogram@thinkecoinc.com'
          };
          if (callback){
            callback();
          }
        },
        updateUser: function(firstName, lastName, callback){
          if (callback){
              callback();
          }
        }
    };
  });

// --- file[validate.js] ---

'use strict';

/**
 * @ngdoc service
 * @name dashApp.validate
 * @description
 * # validate
 * Service in the dashApp.
 */
angular.module('dashApp')
  .service('validate', function validate() {
    // AngularJS will instantiate a singleton by calling "new" on this function
    return {
        validate: function(form, success, failure){
            if (form.$valid){
                success();
            }
            else{
                failure();
            }
        }
    };
  });

// --- file[showerrorsorsuccess.js] ---

'use strict';
/*global $:false */


/**
 * @ngdoc service
 * @name dashApp.showErrorsOrSuccess
 * @description
 * # showErrorsOrSuccess
 * Service in the dashApp.
 */
angular.module('dashApp')
  .service('showErrorsOrSuccess', function showErrorsOrSuccess() {
    // AngularJS will instantiate a singleton by calling "new" on this function
    return{
        show: function(form, valid){
            if (!valid){
                var manual = form.find('.manual-errors'),
                    autogen = form.find('.autogen-errors');
                manual.empty();
                autogen.find('li').each(function(){
                    $('<li>' + $(this).text() + '</li>').appendTo(manual);
                });
            }
            else{
                form.find('.success-message').show();
            }
        }
    };
  });

