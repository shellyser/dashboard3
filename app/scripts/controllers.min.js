// --- file[base.js] ---

'use strict';
/*global $:false */

/**
 * @ngdoc function
 * @name dashApp.controller:BaseCtrl
 * @description
 * # BaseCtrl
 * Controller of the dashApp
 */
angular.module('dashApp')
  .controller('BaseCtrl', function ($scope, program, user, $rootScope, $cacheFactory) {
    $rootScope.page = '';
    user.getUser();
    var cache = $cacheFactory('programCache');
    if (cache.get('defaults') === undefined){
      program.getProgram(function(data){
        $('#loading').fadeOut();
        $rootScope.program = data;
        console.log(data);
        $rootScope.logo = '/assets/img/logo-' + data.ProgramName.toLowerCase() + '.svg';
      });
    }
    else{
      $scope.$broadcast('defaults', cache.get('defaults'));
    }
    //event emitter on sidebar button in header
    $rootScope.changeToggle = function(){
      if ($rootScope.toggle === "collapse")
        $rootScope.toggle = "expand";
      else
        $rootScope.toggle = "collapse";
    };
  });

// --- file[enrollment.js] ---

'use strict';
/*global $:false */

/**
 * @ngdoc function
 * @name dashApp.controller:BaseCtrl
 * @description
 * # BaseCtrl
 * Controller of the dashApp
 */
angular.module('dashApp')
 .controller('EnrollmentCtrl',  function ($scope, enrollmentData, user, $rootScope, $cacheFactory) {
  // if (cache !== undefined){
  //  cache.removeAll();
  // }
  // var cache = $cacheFactory(enrollmentData);
    $scope.viewParameters = {};
    // if (cache.get('defaults') === undefined){
        $scope.enrollmentdata = enrollmentData;
          console.log(enrollmentData);
          $('#loading').fadeOut();
          
          var dates = [];
          if (enrollmentData.dateSpans === undefined){
            dates = [7, 14, 30];
            $scope.enrollmentdata.DateSpans = dates;
          }
          else{
            dates = enrollmentData.dateSpans;
         }
        var yesterday = new Date();
        var dayOfMonth = yesterday.getDate();
            yesterday.setDate(dayOfMonth - 1); 
        var tempEndDate = new Date(yesterday),
            tempStartDate = new Date(yesterday);
            tempStartDate.setDate(tempStartDate.getDate() - (dates[0] - 1));
        $scope.defaults = {
       datespan: "Past " + dates[0] + " Days",
       endDay: tempEndDate.getDate(),
       endMonth: tempEndDate.getMonth() + 1,
       endYear: tempEndDate.getFullYear(),
       endDate: (tempEndDate.getMonth() + 1) + '-' + tempEndDate.getDate() + '-' + tempEndDate.getFullYear(),
       startDay: tempStartDate.getDate(),
       startMonth: tempStartDate.getMonth() + 1,
       startYear: tempStartDate.getFullYear(),
       startDate: (tempStartDate.getMonth() + 1) + '-' + tempStartDate.getDate() + '-' + tempStartDate.getFullYear(),
       timespan: enrollmentData.Defaults.Timespan,
       view: enrollmentData.Defaults.View,
       unit: enrollmentData.Defaults.Unit,
       communication: enrollmentData.Defaults.Communication, 
       modules: enrollmentData.ModuleTypes,
       viewtype: enrollmentData.Defaults.ViewType
        };
        $scope.radiobutton1 = $scope.defaults.viewtype;
        $scope.radiobutton2 = $scope.defaults.viewtype;
        $scope.radiobutton3 = $scope.defaults.viewtype;
        $scope.radiobutton4 = $scope.defaults.viewtype;

       // $scope.changeView = function(viewtype){
       //          // var viewCanvas = $( "li" );
                
       //          console.log(viewtype);
       //         if (viewtype === "daybydayview"){
       //            $(".daybyday").addClass("active");
       //            $(".cumulativeview").removeClass("active");
       //         }                   
       //          else{
       //             $(".cumulativeview").addClass("active");
       //            $(".daybyday").removeClass("active");
       //        }
       //     };

           if ($scope.enrollmentdata.Products.indexOf('Customer') < 0 && $scope.enrollmentdata.Products.indexOf('customer') < 0){
      $scope.enrollmentdata.Products.push('Customer');
        }
        // $scope.$broadcast('defaults', $scope.defaults);
        $scope.viewParameters = $scope.defaults;
          // cache.put('defaults', $scope.defaults);
    // }
    // else{
    //   // $scope.$broadcast('defaults', cache.get('defaults'));
    //   // $scope.viewParameters = cache;
    //   cache.get('defaults', $scope.defaults);
    // }
  // if ($scope.defaults !== undefined){
  //   $scope.viewParameters = $scope.defaults;
  //   console.log($scope.viewParameters);
  // }
  $scope.total = 0;
  $scope.mapData = {};
  $scope.graphsData = {};

  $scope.dateRange = {
    startDate: moment().subtract(7, 'days'),
    endDate: moment().subtract(1, 'days'),
    minDate: moment('2013 01 01', 'YYYY MM DD'),
    maxDate: moment().subtract(1, 'days')
  }

  // $scope.drawGraph = function(id){
 //        $scope.$broadcast('redraw', id);
 //     };
      // $scope.$on('defaults', function(event, data){
      //   $scope.viewParameters = $scope.defaults;
      //    console.log($scope.viewParameters);
      // });
});

// --- file[] ---



// --- file[overview.js] ---

'use strict';
/*global $:false */

/**
 * @ngdoc function
 * @name dashApp.controller:BaseCtrl
 * @description
 * # BaseCtrl
 * Controller of the dashApp
 */
angular.module('dashApp')
  .controller('OverviewCtrl', function ($scope, program, user, $rootScope, $cacheFactory) {
    $rootScope.page = '';
    user.getUser();
      program.getProgram(function(data){
        $('#loading').fadeOut();
        $rootScope.program = data;
        $scope.logo = '/assets/img/logo-' + data.ProgramName.toLowerCase() + '.svg';
      });
});

// --- file[settings.js] ---

'use strict';
// /*global alert:false */
/*global $:false */

/**
 * @ngdoc function
 * @name dashApp.controller:SettingsCtrl
 * @description
 * # SettingsCtrl
 * Controller of the dashApp
 */
angular.module('dashApp')
  .controller('SettingsCtrl', function ($scope, $rootScope, program, user, showErrorsOrSuccess, validate) {
    $rootScope.page = 'account settings';
    $scope.template = 'views/account.html';
    $scope.validate = validate.validate;
    $scope.showNameSuccess = false;
    $scope.showNameError = false;
    $scope.showPasswordSuccess = false;
    $scope.showPasswordError = false;
    $scope.submitChangeName = function(){
        $scope.showNameSuccess = false;
        $scope.showNameError = false;
        if (this.changeName.$valid){
            user.updateUser($('#firstName').val(), $('#lastName').val(), function(){
                showErrorsOrSuccess.show($('#changeName'), true);
                $scope.showNameSuccess = true;
            });
        }
        else{
            showErrorsOrSuccess.show($('#changeName'), false);
            $scope.showNameError = true;
        }
    };
    $scope.submitPassword = function(){
        $scope.showPasswordSuccess = false;
        $scope.showPasswordError = false;
        if(this.changePassword.$valid){
            showErrorsOrSuccess.show($('#changePassword'), true);
            $scope.showPasswordSuccess = true;
            $('#changePassword input[type="password"]').each(function(){
                $(this)[0].value = '';
            });
        }
        else{
            showErrorsOrSuccess.show($('#changePassword'), false);
            $scope.showPasswordError = true;
        }
    };
  });

// --- file[sidebar.js] ---


angular.module('dashApp')
.controller('SidebarCtrl', function ($scope, $location, program) {
    $scope.isActive = function(route) {
        return route === $location.path();
        console.log($location.path());
    }
    // $scope.$on('click', function() { 
    //     $scope.boolChangeClass = !$scope.boolChangeClass;
    //     console.log($scope.boolChangeClass);
    //     if ($scope.boolChangeClass){
    //         // var sidebar_width = $("aside").width();
    //         // var winW = window.innerWidth
    //         // $("main").css({'width': winW - sidebar_width + 107 + 'px'});          
    //         $("main").addClass("expand");
    //     }
    //     else{
    //         $("main").removeClass("expand");
    //     }

    // });

});

// --- file[login.js] ---

'use strict';
/*global $:false */
/*global alert:false */



/**
 * @ngdoc function
 * @name dashApp.controller:LoginCtrl
 * @description
 * # LoginCtrl
 * Controller of the dashApp
 */
angular.module('dashApp')
  .controller('LoginCtrl', function ($scope, user, program, validate, showErrorsOrSuccess, $rootScope) {
      $rootScope.page = 'login';
      $scope.pageType = 'login';
      $scope.showLoginError = false;
      $scope.showError = false;
      $scope.showSuccess = false;
      $scope.validate = validate.validate;
      $scope.submitted = false;
      $scope.loginForm = '';
      $scope.forgotForm = '';
      $scope.forgotEmail = '';
      $scope.yes = function(){
          $scope.submitted = true;
          $scope.showError = false;
          $scope.showSuccess = true;
      };
      $scope.no = function(){
          $scope.showSuccess = false;
          $scope.showError = true;
          showErrorsOrSuccess.show($('#login-forgot'), false);
      };
      $scope.noLogin = function(){
          $scope.showLoginError = true;
          showErrorsOrSuccess.show($('#login-form'), false);
      };
      $scope.sendForgot = function(){
        alert('We\'re going to have to communicate with the server to send a message populated with the user\'s email (' + $scope.email + ') to the support email.');
        $scope.yes();
      };
      $scope.checkForgotThenValidate = function(form, email){
          $scope.forgotForm = form;
          $scope.forgotEmail = email;
          if (!$scope.submitted){
              $scope.validate(form, $scope.sendForgot, $scope.no);
          }
      };
      $scope.submitLogin = function(form, yes, no){
          $scope.loginForm = form;
          $scope.validate(form, yes, no);
      };
      $scope.finishLogin = function(){
          $scope.showLoginError = false;
          user.getUser(function(){
            window.location.replace('/#/dash');
          });
      };
    });

